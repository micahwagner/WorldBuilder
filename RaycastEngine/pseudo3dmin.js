var Pseudo3D=function(){class t{constructor(t){if("object"!=typeof t)throw Error("Camera constructor must recieve a config object");let i=["position","direction",];for(let o=0;o<i.length;o++)if(void 0!==t[i[o]]&&("object"!=typeof t[i[o]]||"number"!=typeof t[i[o]].x||"number"!=typeof t[i[o]].y))throw Error("Camera "+i[o]+" must be an object with x and y attributes that are numbers");if(void 0!==t.focalLength&&"number"!=typeof t.focalLength)throw Error("Camera focalLength must be a number");if(void 0!==t.pitch&&!Number.isInteger(t.pitch))throw Error("Camera pitch must be an integer");if(void 0!==t.lighting){if("object"!=typeof t.lighting)throw Error("Camera lighting must be an object");if(void 0!==t.lighting.brightness&&"number"!=typeof t.lighting.brightness)throw Error("Camera lighting brightness must be a number");if(t.lighting.brightness=t.lighting.brightness||0,void 0!==t.lighting.maxBrightness&&"number"!=typeof t.lighting.maxBrightness)throw Error("Camera lighting maxBrightness must be a number");if(t.lighting.maxBrightness=t.lighting.maxBrightness||1/0,void 0!==t.lighting.color&&!(t.lighting.color instanceof e))throw Error("Camera lighting color must be of type Color");t.lighting.color=t.lighting.color||new e(255,255,255,255)}let r=t.position||{x:0,y:0},s=t.direction||{x:1,y:0};this.orientation=new n(r.x,r.y,s.x,s.y),this.orientation.position.z=.5,this.focalLength=t.focalLength||1,this.plane=new p(-this.orientation.direction.y,this.orientation.direction.x),this.pitch=t.pitch||0,this.lighting=t.lighting||{brightness:0,maxBrightness:1/0,color:new e(255,255,255,255)}}rotate(t){if("number"!=typeof t)throw Error("Camera.rotate must recieve an angle that is a number");return this.orientation.direction.rotate(t),this.plane.x=-this.orientation.direction.y,this.plane.y=this.orientation.direction.x,this}setRotation(t){if("number"!=typeof t)throw Error("Camera.setRotation must recieve an angle that is a number");let e=this.orientation.direction.getMag();return this.orientation.direction.x=Math.cos(t)*e,this.orientation.direction.y=Math.sin(t)*e,this.plane.x=-this.orientation.direction.y,this.plane.y=this.orientation.direction.x,this}move(t,e){if("number"!=typeof t||"number"!=typeof e)throw Error("Camera.move must recieve two numbers");return this.orientation.position.x+=t,this.orientation.position.y+=e,this}setPosition(t,e){if("number"!=typeof t||"number"!=typeof e)throw Error("Camera.setPosition must recieve two numbers");return this.orientation.position.x=t,this.orientation.position.y=e,this}}class e{constructor(t,e,i,o){for(var n=0;n<4;n++)if(!Number.isInteger(arguments[n])||!(arguments[n]>=0&&arguments[n]<=255))throw Error("Color must recieve four integers, each in the range [0, 255]");this.red=t,this.green=e,this.blue=i,this.alpha=o}}class i{constructor(t){if("object"!=typeof t)throw Error("Entity constructor must recieve a config object");if(!(t.appearance instanceof g)&&!(t.appearance instanceof e))throw Error("Entity constructor must receive an appearance argument of type Texture or Color");let i=["position","direction","size"];for(let o=0;o<i.length;o++)if(void 0!==t[i[o]]&&("object"!=typeof t[i[o]]||"number"!=typeof t[i[o]].x||"number"!=typeof t[i[o]].y))throw Error("Entity "+i[o]+" must be an object with x and y attributes that are numbers");if(void 0!==t.position&&void 0!==t.position.z&&"number"!=typeof t.position.z)throw Error("Entity z position must be a number");if(void 0!==t.tint&&!(t.tint instanceof e))throw Error("Entity tint must be of type Color");this.appearance=t.appearance;let r=t.position||{x:0,y:0,z:0},s=t.direction||{x:1,y:0};this.orientation=new n(r.x,r.y,s.x,s.y),this.orientation.position.z=r.z||0,this.size=t.size||{x:1,y:1},this.tint=t.tint,this.isInvisible=!!t.isInvisible,this.hasPartialAlpha=!!t.hasPartialAlpha}}let o={};o.remap=function(t,e,i,o,n){if("number"!=typeof t||"number"!=typeof e||"number"!=typeof i||"number"!=typeof o||"number"!=typeof n)throw Error("remap must recieve five numbers");return(t-e)/(i-e)*(n-o)+o},o.constrain=function(t,e,i){if("number"!=typeof t||"number"!=typeof e||"number"!=typeof i)throw Error("constrain must recieve three numbers");return Math.min(Math.max(x,e),i)};class n{constructor(t,e,i,o){if("number"!=typeof t||"number"!=typeof e||"number"!=typeof i||"number"!=typeof o)throw Error("Orientation constructor must recieve four numbers");this.position=new p(t,e),this.direction=new p(i,o).normalize()}}class r{constructor(t,e,i,o,n,r){if(!(t instanceof d))throw Error("Ray constructor must receive a scene of type Scene");if("number"!=typeof e||"number"!=typeof i||"number"!=typeof o||"number"!=typeof n)throw Error("Ray constructor must receive four numbers: startX, startY, dirX, dirY");if(void 0!==r&&"number"!=typeof r)throw Error("Ray constructor must receive a length that is a number");this.scene=t,r=r||Math.sqrt(o*o+n*n),this.init(e,i,o,n,r)}init(t,e,i,o,n){this.mapX=Math.floor(t),this.mapY=Math.floor(e),this.sideDistX,this.sideDistY,this.stepX,this.stepY,this.deltaDistX=Math.abs(n/i),this.deltaDistY=Math.abs(n/o),this.hit=0,this.side=0,this.face="",i<0?(this.stepX=-1,this.sideDistX=(t-this.mapX)*this.deltaDistX):(this.stepX=1,this.sideDistX=(this.mapX+1-t)*this.deltaDistX),o<0?(this.stepY=-1,this.sideDistY=(e-this.mapY)*this.deltaDistY):(this.stepY=1,this.sideDistY=(this.mapY+1-e)*this.deltaDistY),this.distance=0}cast(){for(this.hit=0;0===this.hit&&(this.sideDistX>this.sideDistY?(this.mapY+=this.stepY,this.sideDistY+=this.deltaDistY,this.side=1):(this.mapX+=this.stepX,this.sideDistX+=this.deltaDistX,this.side=0),!(this.mapX<0)&&!(this.mapY<0)&&!(this.mapX>=this.scene.worldMap.width)&&!(this.mapY>=this.scene.worldMap.height));)this.hit=this.scene.worldMap.data[this.mapX+this.mapY*this.scene.worldMap.width];0===this.side?(this.distance=this.sideDistX-this.deltaDistX,this.stepX<0?this.face="west":this.face="east"):(this.distance=this.sideDistY-this.deltaDistY,this.stepY<0?this.face="north":this.face="south")}}var s={};function h(t,e,i,o,n){let r=t.renderHeight/2+Math.floor(e.pitch),s=i/n*t.renderHeight,h=r-(o-e.orientation.position.z)/n*t.renderHeight;return{start:Math.floor(h-s),end:Math.floor(h)}}function a(t,e,i,o){if(!t.lighting.enabled)return{r:1,g:1,b:1};let n=e.lighting.brightness/(i*e.focalLength);return n>e.lighting.maxBrightness&&(n=e.lighting.maxBrightness),n<t.lighting.ambientLight&&(n=t.lighting.ambientLight),1===o&&(n-=t.lighting.sideShade),{r:n*e.lighting.color.red/255,g:n*e.lighting.color.green/255,b:n*e.lighting.color.blue/255}}function l(t,e,i,o,n,r,s){if(255===i.alpha){o<0&&(o=0),n>t.renderHeight&&(n=t.renderHeight);for(let h=o;h<n;h++){let a=e+h*t.renderWidth;-1!==r&&t.depthBuffer[a]<r||(t.pixels[4*a]=Math.floor(i.red*s.r),t.pixels[4*a+1]=Math.floor(i.green*s.g),t.pixels[4*a+2]=Math.floor(i.blue*s.b),t.pixels[4*a+3]=255,-1===r||(t.depthBuffer[a]=r))}}}function c(t,e,i,o,n,r,s,h){let a=i.height/(r-n),l=n<0?-n*a:0;n<0&&(n=0),r>t.renderHeight&&(r=t.renderHeight);for(let c=n;c<r;c++){let d=e+c*t.renderWidth;if(-1!==s&&t.depthBuffer[d]<=s){l+=a;continue}let f=(o+Math.floor(l)*i.width)*4;if(255!==i.pixels[f+3]){l+=a;continue}t.pixels[4*d]=Math.floor(i.pixels[f]*h.r),t.pixels[4*d+1]=Math.floor(i.pixels[f+1]*h.g),t.pixels[4*d+2]=Math.floor(i.pixels[f+2]*h.b),t.pixels[4*d+3]=255,l+=a,-1!==s&&(t.depthBuffer[d]=s)}}s.renderWalls=function(t,e,i){let o=new r(e,i.orientation.position.x,i.orientation.position.y,0,1,1);for(let n=0;n<t.renderWidth;n++){let s=n/t.renderWidth-.5,d=i.orientation.direction.x*i.focalLength+i.plane.x*t.aspectRatio*s,f=i.orientation.direction.y*i.focalLength+i.plane.y*t.aspectRatio*s;for(o.init(i.orientation.position.x,i.orientation.position.y,d,f,1);;){o.cast();let p=e.worldMap.cellInfo[o.hit];if(0===o.hit)break;if(void 0===p)continue;let u=h(t,i,p.height,p.elevation,o.distance),m=a(e,i,o.distance,o.side),b=p.appearance[o.face];if(b.hasLoaded){let $;$=0===o.side?i.orientation.position.y+o.distance*f:i.orientation.position.x+o.distance*d;let w=Math.floor(($-=Math.floor($))*b.width);0===o.side&&d>0&&(w=b.width-w-1),1===o.side&&f<0&&(w=b.width-w-1),c(t,n,b,w,u.start,u.end,o.distance,m)}else{let y;l(t,n,y=b instanceof g?b.temporaryColor:b,u.start,u.end,o.distance,m)}}}},s.renderFloorCeiling=function(t,i,o){let n=t.renderHeight,r=t.renderWidth,s=Math.floor(n/2+o.pitch),h=i.ceiling.enabled?0:s,l=i.floor.enabled?n:s;h>n&&(h=n),h<0&&(h=0),l>n&&(l=n),l<0&&(l=0);let c=i.floor.appearance,d=i.ceiling.appearance;!1===i.floor.appearance.hasLoaded&&(c=i.floor.appearance.temporaryColor),!1===i.ceiling.appearance.hasLoaded&&(d=i.ceiling.appearance.temporaryColor);let f=o.orientation.direction.x*o.focalLength-o.plane.x*t.aspectRatio*.5,g=o.orientation.direction.y*o.focalLength-o.plane.y*t.aspectRatio*.5,p=o.orientation.direction.x*o.focalLength+o.plane.x*t.aspectRatio*.5,u=o.orientation.direction.y*o.focalLength+o.plane.y*t.aspectRatio*.5;for(let m=h;m<l;m++){let b=m>=s,$=b?c:d,w=$ instanceof e,y=b?i.floor.cellWidth:i.ceiling.cellWidth,v=b?i.floor.cellHeight:i.ceiling.cellHeight,C=m-s,_=Math.abs((b?o.orientation.position.z*n:n*(i.ceiling.height-o.orientation.position.z))/C),S=(p-f)*((_=_===1/0?1e3:_)/t.renderWidth),j=(u-g)*(_/t.renderWidth),I=o.orientation.position.x+f*_,z=o.orientation.position.y+g*_,D=a(i,o,_);for(let L=0;L<t.renderWidth;L++){let V=L+m*r;if(t.depthBuffer[V]<=_){I+=S,z+=j;continue}let M,W,X,Y;if(w)M=Math.floor($.red*D.r),W=Math.floor($.green*D.g),X=Math.floor($.blue*D.b),Y=255;else{let E,R=(Math.floor($.width*Math.abs(I%y/y))+Math.floor($.height*Math.abs(z%v/v))*$.width)*4;M=Math.floor($.pixels[R]*D.r),W=Math.floor($.pixels[R+1]*D.g),X=Math.floor($.pixels[R+2]*D.b),Y=255}t.pixels[4*V]=M,t.pixels[4*V+1]=W,t.pixels[4*V+2]=X,t.pixels[4*V+3]=Y,I+=S,z+=j,t.depthBuffer[V]=_}}},s.renderEntities=function(t,i,o){for(let n=0;n<i.gameObject.entities.length;n++){let r=i.gameObject.entities[n],s=r.orientation.position.x-o.orientation.position.x,d=r.orientation.position.y-o.orientation.position.y,f=o.orientation.direction.x*o.focalLength,g=o.orientation.direction.y*o.focalLength,p=o.plane.x*t.aspectRatio/2,u=o.plane.y*t.aspectRatio/2,m=1/(o.plane.x*t.aspectRatio/2*g-f*o.plane.y*t.aspectRatio/2),b=m*(g*s-f*d),$=m*(-u*s+p*d);if($<0)continue;let w=(b/$+1)/2*t.renderWidth,y=r.size.x/$*t.renderWidth/t.aspectRatio,v=Math.floor(w-y/2),C=Math.floor(w+y/2),_=v;_<0?_=0:_>t.renderWidth&&(_=t.renderWidth);let S=C;S<0?S=0:S>t.renderWidth&&(S=t.renderWidth);let j=h(t,o,r.size.y,r.orientation.position.z,$),I=!1;r.appearance instanceof e?I=!0:!1===r.appearance.hasLoaded&&(I=!0);let z=a(i,o,$);for(let D=_;D<S;D++){if(I){l(t,D,r.appearance,j.start,j.end,$,z);continue}let L=Math.floor((D-v)/(C-v)*r.appearance.width);c(t,D,r.appearance,L,j.start,j.end,$,z)}}},s.renderSkybox=function(t,i,o){let n=i.skybox.appearance;!1===n.hasLoaded&&(n=n.temporaryColor);let s=Math.floor(t.renderHeight/2+o.pitch);if(n instanceof e)t.drawingContext.save(),t.drawingContext.fillStyle=`rgb(
			${n.red*i.lighting.ambientLight}, 
			${n.green*i.lighting.ambientLight}, 
			${n.blue*i.lighting.ambientLight}
		)`,t.drawingContext.fillRect(0,0,t.renderWidth,s),t.drawingContext.restore(),t.setPixels();else if(n instanceof g){let h=new r(i,.5,.5,0,1,1);for(let a=0;a<t.renderWidth;a++){let l,d,f=a/t.renderWidth-.5,p=o.orientation.direction.x*o.focalLength+o.plane.x*t.aspectRatio*f,u=o.orientation.direction.y*o.focalLength+o.plane.y*t.aspectRatio*f;h.init(.5,.5,p,u,1),h.sideDistX<h.sideDistY?(d=.5+h.sideDistX*u,l=2*h.sideDistX):(d=.5+h.sideDistY*p,l=2*h.sideDistY);let m=Math.floor((d-=Math.floor(d))*n.width),b=Math.floor(n.height/l);c(t,a,n,m,s-b,s,-1,{r:i.lighting.ambientLight,g:i.lighting.ambientLight,b:i.lighting.ambientLight})}}},s.render=function(e,i,o){if(!(e instanceof f))throw Error("Failed to render scene: first argument passed to Renderer.render was not an instance of Pseudo3d.Screen");if(!(i instanceof d))throw Error("Failed to render scene: second argument passed to Renderer.render was not an instance of Pseudo3d.Scene");if(!(o instanceof t))throw Error("Failed to render scene: third argument passed to Renderer.render was not an instance of Pseudo3d.Camera");i.skybox.enabled&&s.renderSkybox(e,i,o),0!==i.worldMap.data.length&&0!==Object.keys(i.worldMap.cellInfo).length&&s.renderWalls(e,i,o),0!==i.gameObject.entities.length&&s.renderEntities(e,i,o),(!0===i.floor.enabled||!0===i.ceiling.enabled)&&s.renderFloorCeiling(e,i,o)};class d{constructor(t){if("object"!=typeof t)throw Error("Scene constructor must recieve a config object");let i=["floor","ceiling","worldMap","gameObject","skybox","lighting"];for(let o=0;o<i.length;o++){let n=t[i[o]];if(void 0!==n&&"object"!=typeof n)throw Error("Scene config."+i[o]+" must be an object");t[i[o]]=n||{}}(function t(i){if(void 0!==i.width&&(!Number.isInteger(i.width)||i.width<0))throw Error("Scene worldMap.width must be a positive integer");if(void 0!==i.height&&(!Number.isInteger(i.height)||i.height<0))throw Error("Scene worldMap.height must be a positive integer");if(i.width=i.width||0,i.height=i.height||0,void 0!==i.data&&!Array.isArray(i.data))throw Error("Scene worldMap.data must be an array");if(void 0===i.data){i.data=[];for(let o=0;o<i.height*i.width;o++)i.data[o]=0}if(i.data.length!==i.height*i.width)throw Error("Scene worldMap.data length must be worldMap.width * worldMap.height");if(void 0!==i.cellInfo&&"object"!=typeof i.cellInfo)throw Error("Scene worldMap.cellInfo must be an object");for(let n in i.cellInfo=i.cellInfo||{},i.cellInfo){if("object"!=typeof i.cellInfo[n])throw Error('Scene worldMap.cellInfo["'+n+'"] must be an object');let r=i.cellInfo[n].height;if(void 0!==r&&"number"!=typeof r)throw Error('Scene worldMap.cellInfo["'+n+'"].height must be a number');i.cellInfo[n].height=void 0===r?1:r;let s=i.cellInfo[n].elevation;if(void 0!==s&&"number"!=typeof s)throw Error('Scene worldMap.cellInfo["'+n+'"].elevation must be a number');i.cellInfo[n].elevation=void 0===s?0:s;let h=i.cellInfo[n].appearance;if(void 0!==h&&"object"!=typeof h&&!(h instanceof e)&&!(h instanceof g))throw Error('Scene worldMap.cellInfo["'+n+'"].appearance must be of type Color or Texture, or object');void 0===h&&(h=new e(0,0,0,0));let a;for(let l in a=h instanceof e||h instanceof g?{north:h,south:h,east:h,west:h}:{north:h.north,south:h.south,east:h.east,west:h.west})a[l]instanceof e||a[l]instanceof g||(a[l]=new e(0,0,0,0));i.cellInfo[n].appearance=a}})(t.worldMap),function t(i,o){for(let n=0;n<2;n++){let r=0===n?i:o,s=0===n?"floor":"ceiling";if("{}"===JSON.stringify(r)?r.enabled=!1:r.enabled=!0,void 0!==r.appearance&&!(r.appearance instanceof e)&&!(r.appearance instanceof g))throw Error("Scene "+s+".appearance must be of type Color or Texture");if(r.appearance=r.appearance||new e(0,0,0,0),void 0!==r.cellWidth&&"number"!=typeof r.cellWidth)throw Error("Scene "+s+".cellWidth must be a number");if(void 0!==r.cellHeight&&"number"!=typeof r.cellHeight)throw Error("Scene "+s+".cellHeight must be a number");r.cellWidth=r.cellWidth||1,r.cellHeight=r.cellHeight||1}if(void 0!==o.height&&"number"!=typeof o.height)throw Error("Scene ceiling.height must be a number");o.height=o.height||1}(t.floor,t.ceiling),function t(e){if(void 0!==e.entities&&!Array.isArray(e.entities))throw Error("Scene gameObject.entities must be an array of Entities");if(e.entities=e.entities||[],void 0!==e.resolutionX&&(!Number.isInteger(e.resolutionX)||e.resolutionX<0))throw Error("Scene gameObject.resolutionX must be a positive integer");if(void 0!==e.resolutionY&&(!Number.isInteger(e.resolutionY)||e.resolutionY<0))throw Error("Scene gameObject.resolutionY must be a positive integer");e.resolutionX=e.resolutionX||64,e.resolutionY=e.resolutionY||64}(t.gameObject),function t(i){if(void 0!==i.appearance&&!(i.appearance instanceof e)&&!(i.appearance instanceof g))throw Error("Scene skybox.appearance must be of type Color or Texture");void 0===i.appearance?(i.appearance=new e(0,0,0,0),i.enabled=!1):i.enabled=!0}(t.skybox),function t(e){if(void 0!==e.sideShade&&"number"!=typeof e.sideShade)throw Error("Scene lighting.sideShade must be a number");if(e.sideShade=void 0===e.sideShade?0:e.sideShade,void 0!==e.ambientLight&&"number"!=typeof e.ambientLight)throw Error("Scene lighting.ambientLight must be a number");e.ambientLight=void 0===e.ambientLight?1:e.ambientLight,e.enabled=!(0===e.sideShade&&1===e.ambientLight)}(t.lighting),this.worldMap=t.worldMap,this.floor=t.floor,this.ceiling=t.ceiling,this.gameObject=t.gameObject,this.skybox=t.skybox,this.lighting=t.lighting}add(t){return t instanceof i&&this.gameObject.entities.push(t),this}remove(t){if(t instanceof i){let e=this.gameObject.entities.indexOf(t);this.gameObject.entities.splice(e,1)}return this}}class f{constructor(t,e,i){if(!Number.isInteger(t)||t<=0)throw Error("Screen width must be a positive non-zero integer");if(!Number.isInteger(e)||e<=0)throw Error("Screen height must be a positive non-zero integer");if("number"!=typeof i||!(i>0&&i<=1))throw Error("Screen quality must be a number in the range (0, 1]");if(this.width=t,this.height=e,this.quality=i,this.renderWidth=Math.round(t*i)||1,this.renderHeight=Math.round(e*i)||1,this.htmlCanvasElement=document.createElement("canvas"),!window.CanvasRenderingContext2D)throw Error("Screen failed to initialize because the Canvas element is not supported on this browser");this.drawingContext=this.htmlCanvasElement.getContext("2d",{willReadFrequently:!0}),this.htmlCanvasElement.width=this.renderWidth,this.htmlCanvasElement.height=this.renderHeight,this.htmlCanvasElement.style.width=this.width+"px",this.htmlCanvasElement.style.height=this.height+"px",this.htmlCanvasElement.style["image-rendering"]="pixelated",this.pixels=this.drawingContext.getImageData(0,0,this.renderWidth,this.renderHeight).data,this.depthBuffer=[];for(let o=0;o<this.renderHeight*this.renderWidth;o++)this.depthBuffer[o]=1/0;this.aspectRatio=this.renderWidth/this.renderHeight}clear(){let t=this.drawingContext.createImageData(this.renderWidth,this.renderHeight);this.drawingContext.putImageData(t,0,0),this.pixels=t.data;for(let e=0;e<this.renderHeight*this.renderWidth;e++)this.depthBuffer[e]=1/0}setPixels(){this.pixels=this.drawingContext.getImageData(0,0,this.renderWidth,this.renderHeight).data}update(){let t=new ImageData(this.pixels,this.renderWidth);this.drawingContext.putImageData(t,0,0)}setParent(t){if(!(t instanceof Node))throw Error("Failed to execute Screen.setParent: parameter 1 is not of type node");t.appendChild(this.htmlCanvasElement)}}class g{constructor(t){if("object"!=typeof t)throw Error("Texture constructor must recieve a config object");if("string"!=typeof t.path)throw Error("Texture must recieve source path of type String for image to load");if(void 0!==t.temporaryColor){if(t.temporaryColor instanceof e)this.temporaryColor=t.temporaryColor;else throw Error("Texture temporaryColor must be of type Color")}if(void 0!==t.width){if(Number.isInteger(t.width)&&t.width>0)this.width=t.width;else throw Error("Texture width must be an integer greater than 0")}if(void 0!==t.height){if(Number.isInteger(t.height)&&t.height>0)this.height=t.height;else throw Error("Texture height must be an integer greater than 0")}if(this.width&&!this.height||!this.width&&this.height)throw Error("Texture constructor must receive width and height together");this.path=t.path,this.pixels=void 0,this.hasLoaded=!1,this.temporaryColor=t.temporaryColor||new e(0,0,0,0),this.htmlImageElement=new Image(this.width,this.height),this.htmlImageElement.addEventListener("load",(function(){this.hasLoaded=!0,this.width||this.height||(this.width=this.htmlImageElement.width,this.height=this.htmlImageElement.height);let t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.width,t.height=this.height,e.drawImage(this.htmlImageElement,0,0,this.width,this.height),this.pixels=e.getImageData(0,0,this.width,this.height).data}).bind(this)),this.htmlImageElement.addEventListener("error",(function(t){throw Error("Failed to load image with path "+this.path)}).bind(this)),this.htmlImageElement.src=this.path}}class p{constructor(t,e,i){if("number"!=typeof t||"number"!=typeof e)throw Error("Vector constructor must recieve at least two numbers");if("number"!=typeof i&&void 0!==i)throw Error("Vector z component must be a number");this.x=t,this.y=e,i?(this.z=i,this.is2d=!1):(this.z=0,this.is2d=!0)}add(t){if(!p.isVector(t))throw Error("Vector.add must recieve an object of type Vector");return this.x+=t.x,this.y+=t.y,this.is2d||(this.z+=t.z),this}addConst(t){if("number"!=typeof t)throw Error("Vector.addConst must recieve a number");return this.x+=t,this.y+=t,this.is2d||(this.z+=t),this}subtract(t){if(!p.isVector(t))throw Error("Vector.subtract must recieve an object of type Vector");return this.x-=t.x,this.y-=t.y,this.is2d||(this.z-=t.z),this}subtractConst(t){if("number"!=typeof t)throw Error("Vector.subtractConst must recieve a number");return this.x-=t,this.y-=t,this.is2d||(this.z-=t),this}scale(t){if("number"!=typeof t)throw Error("Vector.scale must recieve a number");return this.x*=t,this.y*=t,this.is2d||(this.z*=t),this}getMagSqr(){return this.is2d?this.x*this.x+this.y*this.y:this.x*this.x+this.y*this.y+this.z*this.z}getMag(){return Math.sqrt(this.getMagSqr())}normalize(){let t=this.getMag();return 0===t||(this.x/=t,this.y/=t,this.is2d||(this.z/=t)),this}setMag(t){if("number"!=typeof t)throw Error("Vector.setMag must recieve a number");return this.normalize().scale(t),this}getSqrDistBtw(t){if(!p.isVector(t))throw Error("Vector.getSqrDistBtw must recieve an object of type Vector");return t.clone().subtract(this).getMagSqr()}getDistBtw(t){if(!p.isVector(t))throw Error("Vector.getDistBtw must recieve an object of type Vector");return Math.sqrt(this.getSqrDistBtw(t))}dot(t){if(!p.isVector(t))throw Error("Vector.dot must recieve an object of type Vector");return this.is2d?this.x*t.x+this.y*t.y:this.x*t.x+this.y*t.y+this.z*t.z}rotate(t,e,i){if("number"!=typeof t)throw Error("Vector.rotate must recieve at least one number");if(!this.is2d&&("number"!=typeof e||"number"!=typeof i))throw Error("Vector.rotate must recieve three numbers if the vector is 3d");let o=Math.cos(t),n=Math.sin(t),r=this.is2d?0:Math.cos(e),s=this.is2d?0:Math.sin(e),h=this.is2d?0:Math.cos(i),a=this.is2d?0:Math.sin(i),l=this.x,c=this.y,d=this.z;return this.is2d?(this.x=l*o-c*n,this.y=l*n+c*o):(this.x=l*(h*r)+c*(h*s*n-a*o)+d*(h*s*o+a*n),this.y=l*(a*r)+c*(a*s*n+h*o)+d*(a*s*o-h*n),this.z=-(l*s)+c*(r*n)+d*(r*o)),this}getAngleBtw(t){if(!p.isVector(t))throw Error("Vector.getAngleBtw must recieve an object of type Vector");return Math.acos(this.dot(t)/(this.getMag()*t.getMag()))}getScalarProj(t){if(!p.isVector(t))throw Error("Vector.getScalarProj must recieve an object of type Vector");return this.dot(t)/t.getMag()}project(t){if(!p.isVector(t))throw Error("Vector.project must recieve an object of type Vector");return this.setTo(t.clone().setMag(this.getScalarProj(t)))}setTo(t){if(!p.isVector(t))throw Error("Vector.setTo must recieve an object of type Vector");return this.x=t.x,this.y=t.y,this.is2d&&(this.z=t.z),this}clone(){return this.is2d?new p(this.x,this.y):new p(this.x,this.y,this.z)}static isVector(t){return t instanceof p}}return{Camera:t,Entity:i,Ray:r,Renderer:s,Scene:d,Screen:f,Math:o,Orientation:n,Vector:p,Color:e,Texture:g}}();